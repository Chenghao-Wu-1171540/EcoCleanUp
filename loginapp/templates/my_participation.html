{% extends "base.html" %}
{% block title %}My Participation{% endblock %}

{% block content %}
<h2 class="mb-4 mb-md-5">
    <i class="bi bi-calendar-check me-2"></i>My Participation
</h2>

{% if registrations|length == 0 %}
<div class="alert alert-info text-center py-5">
    You haven't joined any events yet.<br>
    <a href="{{ url_for('events') }}" class="alert-link">Browse events →</a>
</div>
{% else %}
<div class="row g-4">
    {% for reg in registrations %}
    <div class="col-12 col-lg-6">
        <div class="card shadow-sm border-{% if reg.attendance == 'attended' %}success{% elif reg.attendance == 'absent' %}danger{% else %}warning{% endif %}">
            <div class="card-header d-flex justify-content-between align-items-center">
                <strong>{{ reg.event_name }}</strong>
                <span class="badge {% if reg.attendance == 'attended' %}bg-success{% elif reg.attendance == 'absent' %}bg-danger{% else %}bg-warning{% endif %}">
                    {{ reg.attendance|title }}
                </span>
            </div>
            <div class="card-body">
                <p class="mb-2"><i class="bi bi-geo-alt me-1"></i>{{ reg.location or '—' }}</p>
                <p class="mb-2">
                    <i class="bi bi-calendar-event me-1"></i>
                    {{ reg.event_date.strftime('%Y-%m-%d') if reg.event_date else '—' }}
                </p>
                {% if reg.feedback_submitted %}
                <div class="alert alert-light small mt-3 mb-0">
                    Your rating: <strong>{{ reg.rating }}/5</strong><br>
                    {{ reg.comments|truncate(100) or 'No comment' }}
                </div>
                {% elif reg.attendance == 'attended' and reg.event_date < today %}
                <a href="{{ url_for('submit_feedback', event_id=reg.event_id) }}"
                   class="btn btn-sm btn-outline-success mt-3">
                    Submit Feedback
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}